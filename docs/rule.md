# 自定义抽取规则

> **前置知识**：
>
> 洛谷的每一个题库、难度和标签都有对应的 ID。
>
> 对于题库，有 `P, B, CF, SP, AT, UVA` 六个。
>
> 对于难度，洛谷规定 `0` 代表 `暂未评定`，`1` 代表 `入门`，······，`7` 代表 `NOI/NOI+/CTSC`。
>
> 对于标签，可以通过 [命令 -search]() 查找标签的对应 ID，大致在 0 - 400 之间。同时，标签分为地区、算法、来源、时间、特殊、其它六类。

一个**自定义抽取规则文件**是一个 [JSON](https://www.runoob.com/json/json-syntax.html) 文件，最外层是一个列表，包含多个**抽取规则**，满足任意一个抽取规则即可被选中。

特别地，如果只有一个抽取规则，最外层的列表可以省略。

---

下面是一个抽取规则的示例：

```
{
    "type": ["P", "CF"],
    "difficulty": [4, 5],
    "translated": true,
    "have": [
        [1, 2],
        [3, 4]
    ],
    "no": [5, 6, 7],
    "in": [
        [1, 2, 3, 4, 5, 6],
        [7, 8, 9, 10, 11, 12]
    ],
    "ignore": 1
}
```

抽取规则的格式如下：

抽取规则是一个 JSON 对象（相当于 Python 的 `dict`，C++ 的 `map`），共有 7 个可能的键（每一个都是可选的）：

---

**type**：指定题目所属题库。

如果是一个**数组**，数组的每一项都是一个题库 ID，即 `P, B, CF, SP, AT, UVA` 中的一个。如 `["P", "CF"]` 代表题目必须属于 `P` 题库或者属于 `CF` 题库。

如果被**省略**或者是一个**字符串** `all`，等价于 `["P", "B", "CF", "SP", "AT", "UVA"]`。

如果是一个题库 ID，等价于 `[题库 ID]`。

---

**difficulty**：指定题目难度。

如果是一个**数组**，数组的每一项都是一个难度 ID，即 `0, 1, 2, 3, 4, 5, 6, 7` 中的一个。如 `[3, 4]` 代表题目必须是 `普及+/提高` 难度或者是 `提高+/省选-` 的难度。

如果被**省略**或者是一个**字符串** `all`，等价于 `[0, 1, 2, 3, 4, 5, 6, 7]`。

如果是一个难度 ID，等价于 `[难度 ID]`。

---

**translated**：指定题目是否有翻译。

如果是**布尔值**，`true` 代表有翻译，`false` 代表没有翻译。

如果被**省略**或者是**字符串** `all`，代表是否有翻译均可。

--- 

**have**：指定题目必须含有哪些标签。

如果被**省略**，代表没有要求。

如果是一个**一维数组**，数组的每一项都是一个标签 ID，代表题目必须含有这些标签中的至少一个。

如果是一个**二维数组**，数组的每一项相当于一个条件，题目需要满足任意至少一个条件。对于每一个条件：

每一个条件都是一个数组，数组每一项都是一个标签 ID，代表题目必须**同时含有**数组中的所有标签。

如 `"have": [[1, 2], [3, 4]]` 代表题目必须同时含有标签 `1, 2` 或同时含有标签 `3, 4`。 此时，如果一个题目含有标签 `1, 3` 是不会被抽取到的，而含有标签 `1, 3, 4` 则会被抽取到。

---

**no**：指定题目必须不含有哪些标签。

如果被**省略**，代表没有要求。

如果是一个**一维数组**，数组的每一项都是一个标签 ID，代表题目不能含有这些标签中的任何一个。

如果是一个**二维数组**，数组的每一项相当于一个条件，题目需要满足所有条件。对于每一个条件：

每一个条件都是一个**数组**，数组每一项都是一个标签 ID，代表题目不能同时含有数组中的所有标签。

如 `"no": [[1, 2], [3, 4]]` 代表题目不同时含有标签 `1, 2` 且不同时含有标签 `3, 4`。 此时，如果一个题目只含有标签 `1, 2, 3` 是不会被抽取到的，而只含有标签 `1, 3` 则会被抽取到。

---

**in**：指定题目只能含有哪些标签。

如果被**省略**，代表没有要求。

如果是一个**二维数组**，数组的每一项相当于一个条件，题目需要满足任意至少一个条件。对于每一个条件：

每一个条件都是一个**数组**，数组每一项都是一个标签 ID，代表题目含有的标签必须都在数组中。

如 `"in": [[1, 2], [3, 4]]` 代表题目不能含有除了 `1, 2` 的标签或不能含有除了 `3, 4` 的标签。 此时，如果一个题目只含有标签 `1, 2, 3` 是不会被抽取到的，而只含有标签 `2` 则会被抽取到，且不含有标签的题目也会被抽取到。

---

**ignore**：用于与 `in` 配合。

* 当值为 3 时，`in` 忽略题目含有的时间、来源等非算法标签。
* 当值为 2 时，`in` 忽略题目含有的时间、来源等非算法标签，但题目必须含有一个在条件数组内的标签。
* 当值为 1 时，`in` 要求题目必须含有一个在条件数组内的标签。
* 当值为 0 时，没有其它要求。

当被**省略**时，值为 `2`。

---

因为每一个键都可以被省略，实际上，最简单的抽取规则文件为：

```
{}
```

等价于命令 `-r NN`。

这里还有一个自定义抽取规则文件的示例：

```
[
    {
        "type": "P",
        "difficulty": [4, 5],
        "have": [1]
    }, // P 题库内的绿、蓝题且含有标签 模拟
    {
        "type": "CF",
        "difficulty": 4,
        "translated": true,
        "no": [3]
    } // 或 CF 题库内有翻译的绿题且不含有标签 动态规划,dp
]
```

其中 `//` 后的是注释。